{% extends "base-new.html" %}

{% block site-title %}
    <title>My.jobs - {{ company.name }} - Manage - (beta)</title>
    <meta name="title" content="My.jobs - Manage - {{ company.name }}">
{% endblock %}

{% block meta-extra %}
<!-- <link rel="stylesheet" href="{{STATIC_URL}}pickadate/themes/classic.css" id="theme_base">
<link rel="stylesheet" href="{{STATIC_URL}}pickadate/themes/classic.date.css" id="theme_date"> -->
<link rel="stylesheet" href="{{STATIC_URL}}font-awesome.css">

<!-- New ReactJS Shtuff-->
<script src="{{ STATIC_URL }}reactjs/react.js"></script>
<script src="{{ STATIC_URL }}reactjs/react-dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>


{% endblock %}

{% block content %}

<div id="content"></div>

{% endblock %}

{% block extra-js %}
{% autoescape off %}

{% endautoescape %}
<!--[if IE]>
<script src="{{ STATIC_URL }}es5-sham.min.js"></script>
<![endif]-->
<!-- <script src="{{ STATIC_URL }}bootstrap/bootstrap-modalmanager.js"></script>
<script src="{{ STATIC_URL }}bootstrap/bootstrap-modal.js"></script>

<script src="{{ STATIC_URL }}pickadate/picker.js"></script>
<script src="{{ STATIC_URL }}pickadate/picker.date.js"></script>
<script src="{{ STATIC_URL }}pickadate/legacy.js"></script>
SteelToe: https://github.com/jclem/steeltoe -->
<!-- <script src="{{ STATIC_URL }}steeltoe.js"></script> -->













<script type="text/babel">

  var CancelRoleButton = React.createClass({
    getInitialState: function() {
      return {
      };
    },
    handleClick: function(event) {
      console.log("User clicked CancelRoleButton");

      ReactDOM.render(
        <Container page="Roles" name={this.props.name} company={this.props.company}/>,
          document.getElementById('content')
      );
    },
    render: function() {
      return (
        <a className="btn pull-right" onClick={this.handleClick}><span>Cancel</span></a>
      );
    }
  });

  var SaveRoleButton = React.createClass({
    getInitialState: function() {
      return {
      };
    },
    handleClick: function(event) {
      console.log("User clicked SaveRoleButton");

      // TODO Submit to server
    },
    render: function() {
      return (
        <a className="btn primary pull-right" onClick={this.handleClick}><span>Save Role</span></a>
      );
    }
  });

  var AddRoleButton = React.createClass({
    getInitialState: function() {
      return {
      };
    },
    handleClick: function(event) {
      console.log("User clicked AddRoleButton");

      ReactDOM.render(
        <Container page="EditRole" name={this.props.name} company={this.props.company} action="Add"/>,
          document.getElementById('content')
      );
    },
    render: function() {
      return (
        <a className="btn primary pull-right" onClick={this.handleClick}><span>Add Role</span></a>
      );
    }
  });

  var CancelUsersButton = React.createClass({
    getInitialState: function() {
      return {
      };
    },
    handleClick: function(event) {
      console.log("User clicked CancelUsersButton");

      ReactDOM.render(
        <Container page="Users" name={this.props.name} company={this.props.company}/>,
          document.getElementById('content')
      );
    },
    render: function() {
      return (
        <a className="btn pull-right" onClick={this.handleClick}><span>Cancel</span></a>
      );
    }
  });

  var SaveUserButton = React.createClass({
    getInitialState: function() {
      return {
      };
    },
    handleClick: function(event) {
      console.log("User clicked SaveUserButton");

      // TODO Submit to server
    },
    render: function() {
      return (
        <a className="btn primary pull-right" onClick={this.handleClick}><span>Save User</span></a>
      );
    }
  });

  var AddUserButton = React.createClass({
    getInitialState: function() {
      return {
      };
    },
    handleClick: function(event) {
      console.log("User clicked AddUserButton");

      ReactDOM.render(
      	<Container page="EditUser" name={this.props.name} company={this.props.company} action="Add" />,
          document.getElementById('content')
      );
    },
    render: function() {
      return (
        <a className="btn primary pull-right" onClick={this.handleClick}><span>Add User</span></a>
      );
    }
  });

  var RolesButton = React.createClass({
    getInitialState: function() {
      return {
      };
    },
    handleClick: function(event) {
      console.log("User clicked RolesButton");

      ReactDOM.render(
      	<Container page="Roles" name={this.props.name} company={this.props.company}/>,
          document.getElementById('content')
      );
    },
    render: function() {
      return (
        <a className="btn" onClick={this.handleClick}>Roles</a>
      );
    }
  });

  var UsersButton = React.createClass({
    getInitialState: function() {
      return {
      };
    },
    handleClick: function(event) {
      console.log("User clicked UsersButton");

      ReactDOM.render(
      	<Container page="Users" name={this.props.name} company={this.props.company}/>,
          document.getElementById('content')
      );
    },
    render: function() {
      return (
        <a className="btn" onClick={this.handleClick}>Users</a>
      );
    }
  });

  var UserInvitationEmailForm = React.createClass({
    getInitialState: function() {
      return {
      };
    },
    render: function() {

      var user_invitation_email_template = "You were invited to be a user in an application by DirectEmployers Association.\n\nPlease click the following link to confirm:\n\n[DYNAMIC LINK WILL GO HERE]";

      return (
        <div>
          <div className="row">
            <div className="col-xs-12">
              <label htmlFor="id_invitation_email">Invitation Email to User:</label>
              <textarea id="id_invitation_email" name="id_invitation_email" type="textarea" rows="10" aria-describedby="invitation_email_help">
                {user_invitation_email_template}
              </textarea>
              <p id="inivitation_email_help" className="help-text">The invitation will automatically include a link for this user to confirm their account.</p>
            </div>
          </div>
          <hr/>
        </div>
      );
    }
  });

  var EditUserPage = React.createClass({
    render: function() {
      var user_invitation_email_form = "";
      if (this.props.action == "Add") {
        user_invitation_email_form = <UserInvitationEmailForm />;
      };

      {/* Needed because, apparently, no way to make height of multiselect variable to fill contents */}
      {/* TODO: Update value dynamically */}
      var roles_count = 4;

      return (
        <div>

          <div className="row">
            <div className="col-xs-12">
              <h2>{this.props.action} User</h2>
            </div>
          </div>

          <hr />

          <div className="row">
            <div className="col-xs-10">
              <label htmlFor="id_user_name">User Email Address*:</label>
              <div className="input-group">
                <div className="input-group-addon">@</div>
                <input id="id_user_name" maxLength="255" name="name" type="email" size="35"/>
              </div>
            </div>
          </div>

          <hr/>

          <div className="row">
            <div className="col-xs-12">
              {/* TODO Maybe use this http://projects.skratchdot.com/react-bootstrap-multiselect/ */}
              <label htmlFor="id_roles">Role*:</label>

              <select name="id_roles" size={roles_count} multiple defaultValue={['Analytics Setup', 'Analytics User']} aria-describedby="role_select_help">
                <option value="Analytics Setup">Analytics Setup</option>
                <option value="Analytics User">Analytics User</option>
                <option value="PRM - Read">PRM - Read</option>
                <option value="PRM - Full Access">PRM - Full Access</option>
              </select>
              <p id="role_select_help" className="help-text">To select multiple options on Windows, hold down the Ctrl key. On OS X, hold down the Command key.</p>
            </div>
          </div>

          <hr/>

          {user_invitation_email_form}

          <div className="row">
            <div className="col-xs-12">
              <SaveUserButton />
              <CancelUsersButton />
            </div>
          </div>
        </div>
      );
    }
  });


  var UsersAssignedToThisRoleMultiselect = React.createClass({
     getInitialState: function() {
       return {
       };
     },
     render: function() {
       {/* Needed because, apparently, no way to make height of multiselect variable to fill contents */}
       {/* TODO: Update value dynamically */}
       var users_count = 4;

       var default_value = [];
       if(this.props.action == "Edit"){
         {/* TODO: Does this role already have users? If so, add them to default_value array */}
         default_value.push('dpoynter@apps.directemployers.org');
       }

       return (
        <div>
          <select name="id_users" size={users_count} multiple defaultValue={default_value}>
            <option value="david@apps.directemployers.org">david@apps.directemployers.org</option>
            <option value="dpoynter@apps.directemployers.org">dpoynter@apps.directemployers.org</option>
            <option value="edwin@apps.directemployers.org">edwin@apps.directemployers.org</option>
            <option value="jkoons@apps.directemployers.org">jkoons@apps.directemployers.org</option>
          </select>
        </div>
       );
     }
  });

  var EditRolePage = React.createClass({
    render: function() {

      var users_assigned_to_this_role = <UsersAssignedToThisRoleMultiselect action={this.props.action}/>;

      return (
        <div>
          <div className="row">
            <div className="col-xs-12">
              <h2>{this.props.action} Role</h2>
            </div>
          </div>

          <hr />

          <div className="row">
            <div className="col-xs-12">
              <label htmlFor="id_role_name">Role Name*:</label>
              <input id="id_role_name" maxLength="255" name="name" type="text" size="35"/>
            </div>
          </div>
          <hr/>
          <div className="row">
            <div className="col-xs-5">
              <label>Available Activities:</label>

              <select multiple="multiple" size="10" id="id_site_packages_from" aria-describedby="role_select_help">
                  <option value="Analytics Setup">Analytics Setup</option>
                  <option value="Analytics User">Analytics User</option>
                  <option value="PRM - Read">PRM - Read</option>
                  <option value="PRM - Full Access">PRM - Full Access</option>
              </select>
              <p id="role_select_help" className="help-text">To select multiple options on Windows, hold down the Ctrl key. On OS X, hold down the Command key.</p>
            </div>
            <div className="col-xs-1">
            </div>
            <div className="col-xs-5">
              <label>Activities Assigned to this Role:</label>
              <select multiple="multiple" size="10" id="id_site_packages_to">
              </select>
            </div>
          </div>
          <hr/>

          <div className="row">
            <div className="col-xs-12">

              <label htmlFor="id_users">Users:</label>

              {/* TODO This page is dynamic and either Edit Role or Add Role. How to handle defaultValue if this.props.action ==  Add and defaultValue should be empty? */}
              {users_assigned_to_this_role}

            </div>
          </div>


          <div className="row">
            <div className="col-xs-5 col-xs-offset-7">
              <SaveRoleButton />
              <CancelRoleButton />
            </div>
          </div>
        </div>
      );
    }
  });

  var RolesPage = React.createClass({
    handleEditClick: function(event) {
      console.log("User clicked edit user link");

      ReactDOM.render(
        <Container page="EditRole" name={this.props.name} company={this.props.company} action="Edit"/>,
          document.getElementById('content')
      );
    },
    render: function() {
      return (
        <div>
          <div className="row">
            <div className="col-xs-12">
              <h2>Roles</h2>
            </div>
          </div>

          <hr />

          <div className="row">
            <div className="col-xs-12">
              <table className="table table-hover">
                <thead>
                  <tr>
                    <th>Role</th>
                    <th>User Email</th>
                    <th className="col-md-1"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Analytics Setup</td>
                    <td>
                      <ul>
                        <li>david@apps.directemployers.org</li>
                        <li>edwin@apps.directemployers.org</li>
                      </ul>
                    </td>
                    <td><a onClick={this.handleEditClick}>Edit</a></td>
                  </tr>
                  <tr>
                    <td>Analytics User</td>
                    <td>
                      <ul>
                        <li>david@apps.directemployers.org</li>
                      </ul>
                    </td>
                    <td><a onClick={this.handleEditClick}>Edit</a></td>
                  </tr>
                  <tr>
                    <td>PRM - Full Access</td>
                    <td>
                      <ul>
                        <li>david@apps.directemployers.org</li>
                        <li>jkoons@apps.directemployers.org</li>
                      </ul>
                    </td>
                    <td><a onClick={this.handleEditClick}>Edit</a></td>
                  </tr>
                  <tr>
                    <td>PRM - Read</td>
                    <td>
                      <ul>
                        <li>david@apps.directemployers.org</li>
                        <li>dpoynter@apps.directemployers.org</li>
                        <li>jkoons@apps.directemployers.org</li>
                      </ul>
                    </td>
                    <td><a onClick={this.handleEditClick}>Edit</a></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <hr />

          <div className="row">
            <div className="col-xs-12">
              <AddRoleButton />
            </div>
          </div>
        </div>
      );
    }
  });

  var UsersPage = React.createClass({
    handleEditClick: function(event) {
      console.log("User clicked user edit link");

      ReactDOM.render(
        <Container page="EditUser" name={this.props.name} company={this.props.company} action="Edit" />,
          document.getElementById('content')
      );
    },
    render: function() {
      return (
        <div>
          <div className="row">
            <div className="col-xs-12">
              <h2>Users</h2>
            </div>
          </div>

          <hr />

          <div className="row">
            <div className="col-xs-12">
              <table className="table table-hover">
                <thead>
                  <tr>
                    <th>User Email</th>
                    <th>Associated Roles</th>
                    <th>Status</th>
                    <th className="col-md-1"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>david@apps.directemployers.org</td>
                    <td>
                      <ul>
                        <li>PRM - Read</li>
                        <li>PRM - Full Access</li>
                        <li>Analytics Setup</li>
                        <li>Analytics User</li>
                      </ul>
                    </td>
                    <td><span className="label label-warning">Pending</span></td>
                    <td><a onClick={this.handleEditClick}>Edit</a></td>
                  </tr>
                  <tr>
                    <td>dpoynter@apps.directemployers.org</td>
                    <td>
                      <ul>
                        <li>PRM - Read</li>
                      </ul>
                    </td>
                    <td><span className="label label-success">Active</span></td>
                    <td><a onClick={this.handleEditClick}>Edit</a></td>
                  </tr>
                  <tr>
                    <td>edwin@apps.directemployers.org</td>
                    <td>
                      <ul>
                        <li>Analytics Setup</li>
                      </ul>
                    </td>
                    <td><span className="label label-success">Active</span></td>
                    <td><a onClick={this.handleEditClick}>Edit</a></td>
                  </tr>
                  <tr>
                    <td>jkoons@apps.directemployers.org</td>
                    <td>
                      <ul>
                        <li>PRM - Read</li>
                        <li>PRM - Full Access</li>
                      </ul>
                    </td>
                    <td><span className="label label-success">Active</span></td>
                    <td><a onClick={this.handleEditClick}>Edit</a></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <hr/>

          <div className="row">
            <div className="col-xs-12">
              <AddUserButton />
            </div>
          </div>
        </div>
      );
    }
  });

  var OverviewPage = React.createClass({
    render: function() {
      return (
        <div>
          <div className="row">
            <div className="col-xs-12">
              <h2>Overview</h2>
            </div>
          </div>

          <hr />

          <div className="row">
            <div className="col-xs-12">

              {/* <p>{this.props.name} works with {this.props.company}.</p> */}

              <table className="table table-hover">
                <thead>
                  <tr>
                    <th>Roles</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>5</td>
                  </tr>
                </tbody>
              </table>

              <table className="table table-hover">
                <thead>
                  <tr>
                    <th>Users</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Pending</td>
                    <td>Active</td>
                    <td>Total</td>
                  </tr>
                  <tr>
                    <td>4</td>
                    <td>10</td>
                    <td>14</td>
                  </tr>
                </tbody>
              </table>

            </div>
          </div>
        </div>
      );
    }
  });

  var Content = React.createClass({
    render: function() {

      var page = this.props.page;
      if (page == "Overview") {
        page = <OverviewPage name={this.props.name} company={this.props.company}/>;
      }
      else if (page == "Roles") {
        page = <RolesPage name={this.props.name} company={this.props.company}/>;
      }
      else if (page == "Users") {
        page = <UsersPage name={this.props.name} company={this.props.company}/>;
      }
      else if (page == "EditRole") {
        page = <EditRolePage name={this.props.name} company={this.props.company}  action={this.props.action}/>;
      }
      else if (page == "EditUser") {
        page = <EditUserPage name={this.props.name} company={this.props.company} action={this.props.action}/>;
      }
      return (
        <div className="col-sm-8 panel">
          {page}
        </div>
      );
    }
  });

  var Menu = React.createClass({
    render: function() {
      return (
        <div className="col-sm-4 menu">
          <div className="sidebar">
            <div className="navigation">
              <h2 className="top">Manage</h2>
              <RolesButton name={this.props.name} company={this.props.company}/>
              <UsersButton />
            </div>
          </div>
        </div>
      );
    }
  });

  var Container = React.createClass({
    render: function() {

      if(this.props.name && this.props.company){
        console.log("Welcome. User information passed to ReactJS:");
        console.log(this.props.name);
        console.log(this.props.company);
      }

      return (
        <div>
          <div className="row">
            <div className="col-sm-12">
              <h1 className="bottom-bordered">DirectEmployers <small>Manage</small></h1>
            </div>
          </div>
          <div className="row">

            <Menu />
            <Content page={this.props.page} name={this.props.name} company={this.props.company} action={this.props.action}/>

          </div>
          <div className="clearfix"></div>
        </div>
      );
    }
  });

  ReactDOM.render(
  	<Container page="Overview" name="Daniel" company="DirectEmployers" action=""/>,
      document.getElementById('content')
  );

</script>


{% endblock %}
